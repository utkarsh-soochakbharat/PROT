<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>More Product Information</title>
  <style>
    body { margin: 0; font-family: Montserrat, Arial, sans-serif; color: #0b2141; background: #ffffff; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header { padding: 10px 0 20px; border-bottom: 1px solid #e5e7eb; margin-bottom: 20px; }
    h1 { font-size: 28px; margin: 0; }
    .notice { background: #f3f6fb; border: 1px solid #dee6f5; padding: 12px 14px; border-radius: 8px; color: #134083; margin-bottom: 16px; }
    /* Let large provided HTML breathe full width */
    .content { width: 100%; }
    /* Reset common shop styles that could overflow the iframe */
    img { max-width: 100%; height: auto; }
    iframe { max-width: 100%; border: 0; }
    .hidden { display: none; }
  </style>
  <!-- Loader script will fetch and inject the local snippet below -->
</head>
<body>
  <div class="container">
    <header>
      <h1>Wellness Essentials – Local Preview</h1>
    </header>
    <div class="notice" id="status">Loading local snippet…</div>
    <div class="content" id="injected-content"></div>
  </div>

  <script>
    (async function loadSnippet() {
      const status = document.getElementById('status');
      const target = document.getElementById('injected-content');
      try {
        const res = await fetch('/essentials-snippet.html', { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const htmlText = await res.text();

        // Try to detect if full HTML document
        const hasHtmlTag = /<\s*html[\s>]/i.test(htmlText);
        const hasBodyTag = /<\s*body[\s>]/i.test(htmlText);

        if (hasHtmlTag || hasBodyTag) {
          // Replace entire document with provided doc to mimic original page structure
          const doc = new DOMParser().parseFromString(htmlText, 'text/html');

          // Ensure there is a <base> so relative URLs resolve to gatsport.com
          const ensureBase = () => {
            const existingBase = doc.head.querySelector('base');
            if (!existingBase) {
              const base = doc.createElement('base');
              base.setAttribute('href', 'https://gatsport.com/');
              doc.head.insertBefore(base, doc.head.firstChild);
            }
          };
          ensureBase();

          // Adopt styles and head nodes
          document.head.innerHTML = '';
          Array.from(doc.head.childNodes).forEach(node => {
            document.head.appendChild(document.importNode(node, true));
          });

          // Replace body
          document.body.innerHTML = '';
          Array.from(doc.body.childNodes).forEach(node => {
            // Re-execute scripts by recreating them
            if (node.tagName === 'SCRIPT') {
              const s = document.createElement('script');
              Array.from(node.attributes).forEach(a => s.setAttribute(a.name, a.value));
              s.textContent = node.textContent || '';
              document.body.appendChild(s);
            } else {
              document.body.appendChild(document.importNode(node, true));
            }
          });

          // Hide status if present
          const st = document.getElementById('status');
          if (st) st.classList.add('hidden');
          
          // Inject local CSS overrides (after remote head has been applied)
          // to reduce the vertical gap between stacked sections
          const localStyle = document.createElement('style');
          localStyle.setAttribute('data-local-override', 'section-spacing');
          localStyle.textContent = `
            :root {
              /* tighten default section stack spacing */
              --section-stack-spacing-block: var(--spacing-6);
              /* slightly reduce outer spacing to avoid large gaps */
              --section-outer-spacing-block: var(--spacing-12);
            }
            @media screen and (min-width: 700px) {
              :root { --section-stack-spacing-block: var(--spacing-8); }
            }
            .local-shop-now-wrap{ display:flex; justify-content:center; margin: 14px 0 24px; }
            .local-shop-now-btn{
              appearance:none; display:inline-block; padding: 12px 26px; border-radius: 9999px;
              background:#19428f; color:#fff; font-weight:700; text-decoration:none; letter-spacing:.02em;
              box-shadow: 0 6px 16px rgba(16,47,112,.22); transition: transform .12s ease, background .15s ease;
            }
            .local-shop-now-btn:hover{ background:#153876; transform: translateY(-1px); }
            .local-shop-now-btn:focus-visible{ outline:3px solid #7aa0ff; outline-offset:2px; }
            .local-learn-wrap{ display:flex; justify-content:center; margin: 18px 0 10px; }
            .local-learn-btn{
              appearance:none; display:inline-block; padding: 12px 26px; border-radius: 9999px;
              background:#1b4b96; color:#fff; font-weight:700; text-decoration:none; letter-spacing:.02em;
              box-shadow: 0 6px 16px rgba(16,47,112,.22); transition: transform .12s ease, background .15s ease;
              text-transform: uppercase;
            }
            .local-learn-btn:hover{ background:#153876; transform: translateY(-1px); }
            .local-learn-btn:focus-visible{ outline:3px solid #7aa0ff; outline-offset:2px; }
          `;
          document.head.appendChild(localStyle);

          // Try to insert a visible "Shop Now" button under the CTA text
          (function ensureCtaButton(){
            const normalize = (t) => (t || '')
              .toLowerCase()
              .replace(/[’‘`´]/g, "'")
              .replace(/\s+/g, ' ')
              .trim();
            const targetPhrase = normalize("Shop the Next Generation of Men's and Women's Sportswear");

            function findTargetNode() {
              const blocks = Array.from(document.querySelectorAll('p, h1, h2, h3, h4, div, section, article, span'));
              let found = blocks.find(el => normalize(el.textContent).includes(targetPhrase));
              if (!found) {
                const keywords = ['next generation', "women's sportswear", 'premium performance apparel'];
                found = blocks.find(el => {
                  const txt = normalize(el.textContent);
                  return keywords.some(k => txt.includes(k));
                });
              }
              return found;
            }

            function closestBlock(el) {
              let cur = el;
              const isBlock = (n) => n && ['P','H1','H2','H3','H4','DIV','SECTION','ARTICLE'].includes(n.tagName);
              for (let i = 0; i < 5 && cur; i++) {
                if (isBlock(cur)) return cur;
                cur = cur.parentElement;
              }
              return el;
            }

            function insert() {
              if (document.querySelector('.local-shop-now-btn')) return true;
              const target = findTargetNode();
              if (!target) return false;
              const anchor = closestBlock(target);
              const wrap = document.createElement('div');
              wrap.className = 'local-shop-now-wrap';
              const btn = document.createElement('a');
              btn.className = 'local-shop-now-btn';
              btn.href = '/collections/gat-gear';
              btn.setAttribute('data-origin', 'local-injected');
              btn.textContent = 'SHOP NOW';
              wrap.appendChild(btn);
              const parent = anchor.parentElement || document.body;
              parent.insertBefore(wrap, anchor.nextSibling);
              return true;
            }

            // Try immediately, then with retries, and also observe DOM changes
            let attempts = 0;
            const tryInsert = () => { attempts++; if (insert() || attempts > 60) clearInterval(retryTimer); };
            const retryTimer = setInterval(tryInsert, 250);
            tryInsert();

            const obs = new MutationObserver(() => { insert(); });
            obs.observe(document.body, { childList: true, subtree: true });
          })();

          // Insert LEARN MORE button under Quality Control section
          (function insertLearnMore(){
            const normalize = (t) => (t || '').toLowerCase().replace(/[’‘`´]/g, "'").replace(/\s+/g, ' ').trim();
            const heading = normalize('Decades of the most stringent quality control');
            const keywords = ['stringent quality control', 'quality control', 'decades of'];

            function tryPlace(){
              if (document.querySelector('.local-learn-btn')) return true;
              const blocks = Array.from(document.querySelectorAll('h1, h2, h3, h4, p, div, section, article'));
              let target = blocks.find(el => normalize(el.textContent).includes(heading));
              if (!target) {
                target = blocks.find(el => {
                  const txt = normalize(el.textContent);
                  return keywords.some(k => txt.includes(k));
                });
              }
              
            }

            let attempts = 0; const timer = setInterval(() => { attempts++; if (tryPlace() || attempts > 60) clearInterval(timer); }, 250);
            tryPlace();
          })();
          return;
        }

        // Otherwise, treat as body-only snippet
        target.innerHTML = htmlText;
        // Re-execute inline scripts inside target
        const scripts = target.querySelectorAll('script');
        scripts.forEach(old => {
          const s = document.createElement('script');
          Array.from(old.attributes).forEach(a => s.setAttribute(a.name, a.value));
          s.textContent = old.textContent || '';
          old.replaceWith(s);
        });
        status.textContent = 'Loaded.';
        setTimeout(() => status.classList.add('hidden'), 600);
      } catch (err) {
        console.error('Failed to load snippet', err);
        if (status) status.textContent = 'Failed to load local snippet.';
      }
    })();
  </script>
</body>
</html>



